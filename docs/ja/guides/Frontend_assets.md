# フロントエンドアセット

GenieはYarnやWebpackを利用することで、フロントエンドアセットをコンパイルし、提供します。実際、設定をほぼしない状態(out-of-the-box)で、Webpack4の最も人気のある機能を利用する設定ファイルが提供され、Bootstrap4とJQueryも同様にプリインストールされています。それによりWebアプリに集中することができ、べつの抽象化レイヤーを取り除く事ができます。

まとめると以下の通りです。

- 製品版ではファイルを最小化し、CSSをJavaScriptから分離します
- 開発はノードポート3000でwebpack-dev-serverを利用します(組み込み型のSocketサーバ)に依存
- サポートされたファイル形式：css, scss, sass, js, coffee
- 出力はGenieアプリの`public/dist`に保存されます。
- Bootstrap4とjQueryで事前に設定済
- バンドリングをサポート(チャンクと非同期読み込み)

## 要件

**Genieアプリでアセットパイプラインをインストールするには以下のように`fullstack = true`オプションを利用してアプリを作成する必要があります。**

```julia
julia> Genie.newapp("MyApp", fullstack = true)
```


システムにNodeJSとYarnがインストールされている必要があります。LinuxやMacOSを使用している場合は、パッケージマネージャを利用すると簡単にインストールできます。Windowsの場合は、NodeJSプロジェクトのWebページから関連するインストーラをダウンロードしてください。

## 依存関係のインストール

アプリディレクトリで以下を実行します。

```
yarn install
```

## 開発モード

アプリディレクトリで以下を実行します。

```
yarn run develop
```

静的ファイルはポート3000のNodeサーバのWebSocketを介して提供されます。ソースマップも同様で、簡単にデバッグができます。

静的ファイルへの変更は、自動的にブラウザに送られます。React/Vueを利用する場合、ページの状態は処理中に保存されます。ページを再コンパイルおよび再リロードすることはなく、時間を節約できます。

Genieはデフォルトでは開発モードで動作します。したがって、`app/assets/js/application.js`をメインのエントリポイントとして利用する場合、追加の設定は必要ありません。

## 本番モード

アプリディレクトリで以下を実行します。

```
yarn run build
```

上記は、アプリの`public/dist`ディレクトリにソースマップなしでミニファイされたファイルを出力します。

静的アセットを提供するためには、Genieを本番モードで実行してください。

## 考慮事項

Webpackバンドルを最大限活用するために、JavaScriptの`require`呼び出しを介してすべての静的ファイル(画像やフォント)を提供することを推奨します。Webpackにバンドルを最適化させます。

遅延読み込みもサポートしています。つまり、ブラウザが必要になったときリソースをフェッチするため、ページの読み込みスピードが向上します。例として、ボタンを介したチャット統合を考えてみてください。以下のでもコードでは、チャット機能はユーザがボタンを1度クリックしたときにのみブラウザによってフェッチされます。

```
button.onclick = () => {
  import("./chat").then(chat => {
    chat.init()
  })
}
```

## 最小のBootstrap統合

Webpackの方針に従い、必要な時だけライブラリの依存関係を読み込むことを推奨します。それでもなお、Bootstrapを動かしたいなら、以下のようにすることでできます。

- `app/assets/js/application.js`の下方に`import "bootstrap";`を追加する
- 新たなファイル`app/assets/css/vendor.scss`を作成し、`@import "~bootstrap/scss/bootstrap.scss";`を追加する
- `app/assets/js/application.js`に`require("../css/vendor.scss");`を追加することで、新たなファイルをインクルードする
